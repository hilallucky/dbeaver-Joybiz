-- step 1
--select * from barang b where id in ;

select *
from barang_detail
where id_barang_fk in (3,254,325, 695, 746, 822, 923, 996, 1064, 1148, 1205, 1263, 1335)
ORDER BY id_induk_fk ASC;

-- Step 2
select td.id_barang_fk, td."name", sum(td.qty) as total_barang
from "transaction" t
	join transaction_detail td on t.id = td.id_trans_fk
where 
td.id_barang_fk IN ( -- id_induk_fk dari table barang_detail
1,
3,
5,
6,
8,
10,
11,
13,
16,
17,
18,
42,
43,
44,
61,
62,
67,
87,
111,
112,
113,
114,
115,
127,
128,
129,
142,
143,
152,
156,
176,
181,
182,
183,
189,
190,
193,
196,
197,
200,
201,
202,
205,
206,
211,
214,
215,
220,
221,
222,
223,
231,
232,
233,
234,
236,
237,
243,
244,
245,
246,
252,
254,
273,
276,
278,
287,
289,
291,
317,
319,
325,
345,
346,
347,
362,
378,
390,
393,
394,
395,
396,
404,
408,
409,
410,
411,
420,
421,
424,
428,
429,
430,
431,
432,
433,
434,
437,
438,
449,
450,
451,
452,
453,
456,
468,
486,
498,
499,
500,
501,
502,
503,
504,
505,
506,
507,
508,
509,
510,
511,
512,
526,
531,
536,
538,
541,
542,
545,
549,
553,
554,
560,
561,
562,
570,
574,
577,
579,
583,
598,
603,
604,
607,
608,
612,
613,
615,
616,
617,
625,
644,
645,
648,
649,
650,
651,
652,
653,
655,
656,
657,
659,
660,
662,
664,
670,
675,
676,
680,
682,
683,
684,
685,
686,
687,
688,
689,
690,
695,
699,
700,
711,
712,
713,
715,
717,
721,
722,
729,
732,
735,
737,
746,
761,
770,
771,
772,
780,
782,
783,
787,
792,
794,
802,
822,
841,
853,
854,
861,
862,
867,
874,
888,
892,
893,
894,
904,
907,
908,
923,
940,
950,
954,
960,
965,
967,
968,
969,
975,
976,
978,
990,
996,
1013,
1023,
1026,
1032,
1037,
1040,
1041,
1044,
1045,
1047,
1064,
1081,
1091,
1092,
1100,
1106,
1111,
1118,
1119,
1120,
1121,
1123,
1142,
1148,
1162,
1172,
1178,
1182,
1188,
1189,
1190,
1191,
1193,
1201,
1205,
1217,
1228,
1234,
1238,
1244,
1245,
1246,
1247,
1255,
1256,
1257,
1263,
1264,
1285,
1298,
1299,
1300,
1303,
1304,
1308,
1319,
1322,
1326,
1327,
1335,
1349,
1351,
1373,
1375,
1376,
1386,
1400,
1405,
1412,
1414,
1415,
1416,
1417,
1418,
1431,
1442,
1443,
1444,
1445,
1446,
1447,
1450,
1451,
1452,
1462,
1476,
1481,
1488,
1490,
1491,
1501,
1504,
1513,
1517,
1519,
1532,
1534,
1538,
1539,
1540,
1541,
1544,
1559,
1569,
1581,
1586,
1587,
1589,
1593,
1596,
1597,
1598,
1599,
1600,
1601,
1603,
1608,
1609,
1626,
1630,
1632,
1633
) and t.transaction_date BETWEEN '2023-08-31' and '2023-09-27' -- (kamis pertama di bulan berjalan sampai rabu terakhir di bulan selanjutnya)
and t.deleted_at is null and t.transaction_date is not null
GROUP BY td."id_barang_fk",td."name"
ORDER BY td.id_barang_fk;



-- Step 3
select * 
from barang_detail
where id_barang_fk in (3,254,325, 695, 746, 822, 923, 996, 1064, 1148, 1205, 1263, 1335) 
and id_induk_fk in
(
1,
3,
5,
6,
8,
10,
11,
13,
16,
17,
18,
42,
43,
44,
61,
62,
67,
87,
111,
112,
113,
114,
115,
127,
128,
129,
142,
143,
152,
156,
176,
181,
182,
183,
189,
190,
193,
196,
197,
200,
201,
202,
205,
206,
211,
214,
215,
220,
221,
222,
223,
231,
232,
233,
234,
236,
237,
243,
244,
245,
246,
252,
254,
273,
276,
278,
287,
289,
291,
317,
319,
325,
345,
346,
347,
362,
378,
390,
393,
394,
395,
396,
404,
408,
409,
410,
411,
420,
421,
424,
428,
429,
430,
431,
432,
433,
434,
437,
438,
449,
450,
451,
452,
453,
456,
468,
486,
498,
499,
500,
501,
502,
503,
504,
505,
506,
507,
508,
509,
510,
511,
512,
526,
531,
536,
538,
541,
542,
545,
549,
553,
554,
560,
561,
562,
570,
574,
577,
579,
583,
598,
603,
604,
607,
608,
612,
613,
615,
616,
617,
625,
644,
645,
648,
649,
650,
651,
652,
653,
655,
656,
657,
659,
660,
662,
664,
670,
675,
676,
680,
682,
683,
684,
685,
686,
687,
688,
689,
690,
695,
699,
700,
711,
712,
713,
715,
717,
721,
722,
729,
732,
735,
737,
746,
761,
770,
771,
772,
780,
782,
783,
787,
792,
794,
802,
822,
841,
853,
854,
861,
862,
867,
874,
888,
892,
893,
894,
904,
907,
908,
923,
940,
950,
954,
960,
965,
967,
968,
969,
975,
976,
978,
990,
996,
1013,
1023,
1026,
1032,
1037,
1040,
1041,
1044,
1045,
1047,
1064,
1081,
1091,
1092,
1100,
1106,
1111,
1118,
1119,
1120,
1121,
1123,
1142,
1148,
1162,
1172,
1178,
1182,
1188,
1189,
1190,
1191,
1193,
1201,
1205,
1217,
1228,
1234,
1238,
1244,
1245,
1246,
1247,
1255,
1256,
1257,
1263,
1264,
1285,
1298,
1299,
1300,
1303,
1304,
1308,
1319,
1322,
1326,
1327,
1335,
1349,
1351,
1373,
1375,
1376,
1386,
1400,
1405,
1412,
1414,
1415,
1416,
1417,
1418,
1431,
1442,
1443,
1444,
1445,
1446,
1447,
1450,
1451,
1452,
1462,
1476,
1481,
1488,
1490,
1491,
1501,
1504,
1513,
1517,
1519,
1532,
1534,
1538,
1539,
1540,
1541,
1544,
1559,
1569,
1581,
1586,
1587,
1589,
1593,
1596,
1597,
1598,
1599,
1600,
1601,
1603,
1608,
1609,
1626,
1630,
1632,
1633
) ORDER BY id_induk_fk asc;


select a.id, a."sDate", a."eDate", a."month", a."year", a."name"
from (
		select  wp.id, wp."sDate" , wp."eDate" , wp."name",
				DATE_PART('Month', wp."sDate"::DATE) as "start_date", 
				DATE_PART('Month', wp."eDate"::DATE) as "end_date", 
--				substring(wp."name", 4, 2)::integer as "month", 
--				substring(wp."name", 1, 2)::integer as "year"
				case
					when (substring(wp."name", 5, 1) = '.') then substring(wp."name", 4, 1)::integer
					else substring(wp."name", 4, 2)::integer
				end as "month",
				substring(wp."name", 1, 2)::integer as "year"
				-- , wp."name"::DATE
		from week_periodes wp
	) a
where ((a."month" between 1 and 5) and a."year" = 24) or (a."month" = 12 and a."year" = 23)
order by a.id
		;

select *
from barang b 
where b.core = false 
;

select t.id, t.transaction_date, td.id_barang_fk, b.id as id_barang, td."name", b.nama, td.qty, b.core 
from "transaction" t 
	inner join transaction_detail td on t.id = td.id_trans_fk 
	inner join barang b on td.id_barang_fk = b.id 
where t.transaction_date between '2023-11-01' and now()::DATE
	and t.deleted_at is null
	and t.status in('PC', 'S', 'A', 'I') -- PAID
;

